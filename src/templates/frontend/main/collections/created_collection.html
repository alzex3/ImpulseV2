{% extends 'frontend/main/collections/main_collection.html' %}



{% block body %}
    <div class="created-collection-display-list align-items-center">
        {% for collection in collections %}
            <div id="collectionDisplay" data-id="{{ collection.id }}" class="created-collection-display">
                <div class="collection-title-display">
                    <p class="collection-title inner-font">{{ collection.name }}</p>
                    <button class="active-collection-spase">
                        <span>Активировать&nbsp;коллекцию</span>
                    </button>
                </div>
                <div class="collection-info">
                    <p class="amoun-cards inner-font">Всего карточек: {{ collection.size }}</p>
                    <p class="collection-status-display inner-font">Статус: {{ collection.status }} </p>
                </div>
                <div class="collection-items-display">
                    <div class="collection-cover-display">
                        {% if collection.cover %}
                            <img src="https://s-cdn.sportbox.ru/images/styles/upload/fp_fotos/6b/b7/f23826911f9e07882ab082534677d9075d6ea6d55e740138464440.jpg"
                                 alt="Collection cover">
                        {% else %}
                            Обложка коллекции отуствует
                        {% endif %}
                    </div>
                    <div class="collection-description-display">
                        {% if collection.motto %}
                            <p class="inner-font">{{ collection.motto }}</p>
                        {% else %}
                            Описание коллекции отсутствует
                        {% endif %}
                    </div>
                </div>
                <div class="create-cards-display">
                    <div class="cards-display">
                        <img src="/static/images/cards/common.png" alt="Common cards" class="image-card">
                        <div class="card-type-info">
                            <h1 class="card-type-name inner-font">Обычные карточки</h1>
                            <p class="amount-cards-by-type inner-font">Колличество: 44</p>
                        </div>
                        <button id="cardsBatton" onclick="TestFunc(this)" data-id='{{ collection.id }}'
                                data-type="common"
                                class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseExample-{{ collection.id }}" aria-expanded="false"
                                aria-controls="collapseExample-{{ collection.id }}">
                        </button>
                    </div>
                    <div class="cards-display">
                        <img src="/static/images/cards/uncommon.png" alt="Uncommon cards" class="image-card">
                        <div class="card-type-info">
                            <h1 class="card-type-name inner-font">Необычные карточки</h1>
                            <p class="amount-cards-by-type inner-font">Колличество: 22</p>
                        </div>
                        <button id="cardsBatton" onclick="TestFunc(this)" data-id='{{ collection.id }}'
                                data-type="uncommon"
                                class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseExample-{{ collection.id }}" aria-expanded="false"
                                aria-controls="collapseExample-{{ collection.id }}">
                        </button>
                    </div>
                    <div class="cards-display">
                        <img src="/static/images/cards/rare.png" alt="Common cards" class="image-card">
                        <div class="card-type-info">
                            <h1 class="card-type-name inner-font">Редкие<br>карточки</h1>
                            <p class="amount-cards-by-type inner-font">Колличество: 10</p>
                        </div>
                       <button id="cardsBatton" onclick="TestFunc(this)" data-id='{{ collection.id }}'
                                data-type="rare"
                                class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseExample-{{ collection.id }}" aria-expanded="false"
                                aria-controls="collapseExample-{{ collection.id }}">
                        </button>
                    </div>
                    <div class="cards-display">
                        <img src="/static/images/cards/legendary.png" alt="Uncommon cards" class="image-card">
                        <div class="card-type-info">
                            <h1 class="card-type-name inner-font">Легендарные карточки</h1>
                            <p class="amount-cards-by-type inner-font">Колличество: 44</p>
                        </div>
                        <button id="cardsBatton" onclick="TestFunc(this)" data-id='{{ collection.id }}'
                                data-type="legendary"
                                class="btn btn-primary" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseExample-{{ collection.id }}" aria-expanded="false"
                                aria-controls="collapseExample-{{ collection.id }}">
                        </button>
                    </div>
                </div>
                <div class="dp-col-cards collapse" id="collapseExample-{{ collection.id }}">
                    <div id='cardsListDisplay' class="collection-cards-display card card-body">

                    </div>
                </div>
            </div>
        {% endfor %}
        <script>
            function TestFunc(button) {
                let id = $(button).data('id');
                let type = $(button).data('type');
                let targetDiv = $(`div[data-id="${id}"]`);
                let innerDivId = 'createNewCard'
                let cardsDiv = targetDiv.find(`#${innerDivId}`);
                let cardsListDiv = targetDiv.find('#cardsListDisplay')
                cardsListDiv.empty()
                if (type === 'common') {
                    cardsDiv.css('background-color', '#867661');
                } else if (type === 'uncommon') {
                     cardsDiv.css('background-color', 'green');
                } else if (type === 'rare') {
                    cardsDiv.css('background-color', 'blue');
                } else {
                    cardsDiv.css('background-color', 'yellow');
                }
                let x = targetDiv.height()
                if (targetDiv.height() < 600) {
                    targetDiv.animate({height: "2900px"}, 500);
                } else {
                    targetDiv.animate({height: '637px'}, 500);
                }
                $.ajax({
                    url: `http://127.0.0.1:8000/collection/${id}/cards/?q=${type}`,
                    type: 'GET',
                    success: function(response) {
                        let data = response
                        for (let i = 1; i < 44; i++) {

                            if (i in data) {

                                let CardsCreatedDiv = $('<div class="create-card-form"></div>');
                                let SomeDiv = $('<div class="create-image-form"></div>');
                                let url = data[i]['url']
                                let newImg = $('<img>', {
                                    src: url, // Укажите путь к вашему изображению
                                    alt: 'test',
                                    // Описание изображения для доступности
                                });
                                SomeDiv.append(newImg);
                                CardsCreatedDiv.append(SomeDiv)
                                cardsListDiv.append(CardsCreatedDiv)
                            } else {
                                let somediv = $('<div class="create-card-form"></div>')
                                let SomeoneDiv = $('<div class="create-image-form"></div>')
                                let CreateLink = $('<a href="#" class="create-cards-link-form inner-font">Добавить<br>картинку</a>');
                                let Ptag = $('<p class="inner-font">Название карточки</p>')
                                SomeoneDiv.append(CreateLink)
                                somediv.append(SomeoneDiv)
                                somediv.append(Ptag)
                                cardsListDiv.append(somediv);
                            }
                        }
                    },
                    error: function (jqXHR, testStatus, errorThrow) {
                        console.log(testStatus, errorThrow)
                    }
                });


                {#$(`#collapseExample-${id}`).on('hidden.bs.collapse', function () {#}
                {#    cardsListDiv.empty()#}
                {#   console.log("Коллапс закрыт");#}

            }
        </script>



    </div>
{% endblock %}